<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Have A Buddy — October 2025</title>
  <style>
    body { font-family: -apple-system, system-ui, sans-serif; line-height: 1.45; margin: 24px; }
    header { display:flex; align-items:center; gap:16px; margin-bottom:16px; flex-wrap: wrap; }
    .row { display:flex; align-items:center; gap:8px; margin:6px 0; flex-wrap: wrap; }
    .card { border:1px solid #ddd; border-radius:12px; padding:12px 14px; margin:12px 0; }
    .small { color:#777; font-size: 12px; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, monospace; }
    audio { width: 320px; }
    select { padding:6px 8px; border-radius:8px; border:1px solid #ccc; }
  </style>
</head>
<body>
  <header>
    <h1>Have A Buddy — October 2025</h1>
    <div class="row">
      <label for="episodeFilter">Filter by episode:</label>
      <select id="episodeFilter"><option value="">All</option></select>
    </div>
    <div class="small">Portable read-only page. Share this folder as-is (keep <span class="mono">clips/</span> with it).</div>
  </header>
  <div id="hits"></div>

<script id="payload" type="application/json">[{"episode": "25-10-04", "episode_pretty": "October 4", "start": 1415.656, "end": 1432.976, "text": "I had a buddy who used to do this specifically with another buddy who never had never purchased a pack of cigarettes but not like me where I'd get one or two on a weekend when I was hammered would ask for a cigarette every single time everyone else who smoked got a cigarette.", "speaker_id": "SPEAKER_08", "speaker": "JAKE", "clip": "clips/25-10-04_hab_001.mp3"}, {"episode": "25-10-10", "episode_pretty": "October 10", "start": 4197.922, "end": 4201.288, "text": "We have a buddy of mine's in first and the one that I run, but okay.", "speaker_id": "SPEAKER_08", "speaker": "JARED", "clip": "clips/25-10-10_hab_001.mp3"}, {"episode": "25-10-10", "episode_pretty": "October 10", "start": 7369.694, "end": 7370.616, "text": "I had a buddy of mine do it.", "speaker_id": "SPEAKER_06", "speaker": "BLAKE", "clip": "clips/25-10-10_hab_002.mp3"}, {"episode": "25-10-14", "episode_pretty": "October 14", "start": 2632.775, "end": 2636.742, "text": "I had a buddy really tell, like, pitching me how, like, you gotta do the saltwater pool, dude.", "speaker_id": "SPEAKER_07", "speaker": "DAN", "clip": "clips/25-10-14_hab_001.mp3"}, {"episode": "25-10-22", "episode_pretty": "October 22", "start": 9553.732, "end": 9555.054, "text": "Or he had a buddy with a camera.", "speaker_id": "SPEAKER_07", "speaker": "DAN", "clip": "clips/25-10-22_hab_001.mp3"}, {"episode": "25-10-24", "episode_pretty": "October 24", "start": 338.502, "end": 342.428, "text": "Luckily enough, I had a buddy going to the airport about the time I needed to go to your house.", "speaker_id": "SPEAKER_03", "speaker": "BLAKE", "clip": "clips/25-10-24_hab_001.mp3"}]</script>
<script>
let data = [];
try {
  data = JSON.parse(document.getElementById('payload').textContent);
  if (!Array.isArray(data)) data = [];
} catch (e) {
  const pre = document.createElement('pre');
  pre.textContent = 'JSON parse error: ' + e.message;
  pre.style.color = 'crimson';
  document.body.insertBefore(pre, document.body.firstChild);
}

function render() {
  const container = document.getElementById('hits');
  const select = document.getElementById('episodeFilter');
  if (!select.dataset.init) {
    const episodes = Array.from(new Set(data.map(d => d.episode))).sort();
    episodes.forEach(ep => { const opt = document.createElement('option'); opt.value = ep; opt.textContent = ep; select.appendChild(opt); });
    select.dataset.init = "1";
    select.onchange = () => render();
  }
  container.innerHTML = '';
  const filterEp = select.value || '';
  const items = filterEp ? data.filter(d => d.episode === filterEp) : data;
  if (!items.length) {
    const d = document.createElement('div'); d.className = 'small'; d.textContent = 'No matches.'; container.appendChild(d); return;
  }
  items.forEach((item, idx) => {
    const card = document.createElement('div'); card.className = 'card';
    const title = document.createElement('div'); title.className = 'row';
    const left = document.createElement('div');
    left.innerHTML = '<strong>#' + (idx+1) + '</strong> ' +
                     '<span class="small">(episode: ' + (item.episode || '?') +
                     ', speaker: ' + (item.speaker || item.speaker_id || '?') + ')</span>';
    const right = document.createElement('div'); right.className = 'small mono';
    const s = Number(item.start || 0).toFixed(2), e = Number(item.end || 0).toFixed(2);
    right.textContent = '@ ' + s + 's – ' + e + 's';
    title.appendChild(left); title.appendChild(right);

    const row = document.createElement('div'); row.className = 'row';
    const audio = document.createElement('audio'); audio.controls = true; audio.preload = 'metadata';
    audio.src = item.clip;
    const text = document.createElement('span');
    // Avoid quotes that could break HTML; payload already contains raw text.
    text.textContent = '  ' + (item.text || '');
    row.appendChild(audio); row.appendChild(text);

    card.appendChild(title); card.appendChild(row); container.appendChild(card);
  });
}
render();
</script>
</body>
</html>
